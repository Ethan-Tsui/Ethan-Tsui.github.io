<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>pytest学习 | Ethan's Knowledge Hut</title><meta name="author" content="Ethan"><meta name="copyright" content="Ethan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="pytest 基本使用pytest 介绍pytest 是 python 语言下的一种单元测试框架，与 python 自带的 unittest 单元测试框架类似，相比于 unittest 框架使用起来更简洁，效率更高（java语言下的单元测试框架是junit和testng） pytest 可以结合 requests 实现接口测试，结合 selenium&#x2F;playwright、appium">
<meta property="og:type" content="article">
<meta property="og:title" content="pytest学习">
<meta property="og:url" content="http://example.com/2024/07/20/pytest%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="Ethan&#39;s Knowledge Hut">
<meta property="og:description" content="pytest 基本使用pytest 介绍pytest 是 python 语言下的一种单元测试框架，与 python 自带的 unittest 单元测试框架类似，相比于 unittest 框架使用起来更简洁，效率更高（java语言下的单元测试框架是junit和testng） pytest 可以结合 requests 实现接口测试，结合 selenium&#x2F;playwright、appium">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://picture-picture.oss-cn-beijing.aliyuncs.com/wallhaven-exrqrr.jpg">
<meta property="article:published_time" content="2024-07-20T06:00:08.000Z">
<meta property="article:modified_time" content="2024-09-10T02:02:27.809Z">
<meta property="article:author" content="Ethan">
<meta property="article:tag" content="个人博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://picture-picture.oss-cn-beijing.aliyuncs.com/wallhaven-exrqrr.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/07/20/pytest%E5%AD%A6%E4%B9%A0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?73c32659cf386aa28a615345d8d0b897";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'pytest学习',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-10 10:02:27'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://myth-picture.oss-cn-beijing.aliyuncs.com/b_c5889573e79ba39f657f4ad01e0af210.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://picture-picture.oss-cn-beijing.aliyuncs.com/wallhaven-exrqrr.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Ethan's Knowledge Hut"><span class="site-name">Ethan's Knowledge Hut</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">pytest学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-20T06:00:08.000Z" title="发表于 2024-07-20 14:00:08">2024-07-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-09-10T02:02:27.809Z" title="更新于 2024-09-10 10:02:27">2024-09-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/">测试开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>31分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="pytest学习"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="pytest-基本使用"><a href="#pytest-基本使用" class="headerlink" title="pytest 基本使用"></a>pytest 基本使用</h1><h2 id="pytest-介绍"><a href="#pytest-介绍" class="headerlink" title="pytest 介绍"></a>pytest 介绍</h2><p>pytest 是 python 语言下的一种<strong>单元测试框架</strong>，与 python 自带的 unittest 单元测试框架类似，相比于 unittest 框架使用起来更简洁，效率更高（java语言下的单元测试框架是junit和testng）</p>
<p>pytest 可以结合 requests 实现接口测试，结合 selenium&#x2F;playwright、appium 实现自动化功能测试。</p>
<p>pytest 特点：</p>
<ol>
<li>具有unittest绝大部分功能，非常容易上手，入门简单，功能灵活，文档丰富，文档中有很多实例可以参考</li>
<li>具有强大灵活的fixture固件，支持简单的单元测试和复杂的功能测试；</li>
<li>支持参数化（parametrize）、数据驱动</li>
<li>执行测试过程中可以将某些测试跳过（skip），或者对某些预期失败的case标记成失败（xfail）</li>
<li>支持重复执行（rerun）失败的case</li>
<li>支持运行由nose ，unittest编写的测试case</li>
<li>支持执行部分用例（比如：根据标记，或者features、stories，后者一来allure <code>-</code> pytest插件）</li>
<li>具有很多第三方插件（顺序控制pytest - ordering、allure报告allure - pytest、多线程pytest - xdist、……），并且可以自定义开发插件</li>
<li>可生成html报告，也可以结合allure生成精美的测试报告</li>
<li>方便的和持续集成工具jenkins集成</li>
</ol>
<p>unittest 和 pytest 的区别：</p>
<table>
<thead>
<tr>
<th><strong>不同点</strong></th>
<th><strong>unittest</strong></th>
<th><strong>pytest</strong></th>
</tr>
</thead>
<tbody><tr>
<td>命名</td>
<td>测试方法以test开头</td>
<td>模块名必须以 test_ 开头，或者_test 结尾<br><br>类以Test开头<br><br>方法&#x2F;函数以test开头</td>
</tr>
<tr>
<td>框架结构</td>
<td>写case必须定义类，测试类要继承unitttest.TestCase</td>
<td>不需要继承，可以是函数也可以是类中方法</td>
</tr>
<tr>
<td>测试报告</td>
<td>使用HTMLTestRunner</td>
<td>使用allure-pytest</td>
</tr>
<tr>
<td>数据驱动</td>
<td>参数化使用第三方ddt</td>
<td>参数化使用自带的parametrize</td>
</tr>
<tr>
<td>断言</td>
<td>断言库丰富</td>
<td>采用python断言：使用assert关键字</td>
</tr>
<tr>
<td>失败重试</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>固件</td>
<td>-</td>
<td>灵活的fixture固件</td>
</tr>
<tr>
<td>扩展性</td>
<td>-</td>
<td>快速自定义插件开发</td>
</tr>
</tbody></table>
<h2 id="pytest-编写规则"><a href="#pytest-编写规则" class="headerlink" title="pytest 编写规则"></a>pytest 编写规则</h2><p>1、<strong>测试模块</strong>：测试文件通常以 <code>test_</code> 开头或结尾，这样 <code>pytest</code> 可以自动发现这些文件。例如：<code>test_example.py</code> 或者 <code>example_test.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test_example.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_addition</span>():</span><br><span class="line">    <span class="keyword">assert</span> <span class="number">1</span> + <span class="number">1</span> == <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_subtraction</span>():</span><br><span class="line">    <span class="keyword">assert</span> <span class="number">2</span> - <span class="number">1</span> == <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>2、<strong>测试类</strong></p>
<ul>
<li>测试类名称应以 <code>Test</code> 开头，这样更容易被识别为测试类</li>
<li>不需要继承自任何基类</li>
<li>类中的每个测试方法仍需以 <code>test_</code> 开头</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test_string_methods.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestStringMethods</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_upper</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">assert</span> <span class="string">&#x27;hello&#x27;</span>.upper() == <span class="string">&#x27;HELLO&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_isupper</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">assert</span> <span class="string">&#x27;HELLO&#x27;</span>.isupper()</span><br><span class="line">        <span class="keyword">assert</span> <span class="keyword">not</span> <span class="string">&#x27;Hello&#x27;</span>.isupper()</span><br></pre></td></tr></table></figure>

<p>3、包：包名无特殊要求，但必须有 <code>\_init_.py</code> 文件</p>
<h1 id="pytest-运行方式"><a href="#pytest-运行方式" class="headerlink" title="pytest 运行方式"></a>pytest 运行方式</h1><h2 id="主函数运行"><a href="#主函数运行" class="headerlink" title="主函数运行"></a>主函数运行</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_01</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;啥也没有&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main()</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240807193258.png" alt="image.png"></p>
<h2 id="命令行运行"><a href="#命令行运行" class="headerlink" title="命令行运行"></a>命令行运行</h2><p>文件路径 testcase&#x2F;test_one.py，在终端输入如下内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest ./testcase/test_one.py --html=./report/report.html</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240807193238.png" alt="image.png"></p>
<blockquote>
<p>[!note] pytest 用例查找规则</p>
</blockquote>
<table>
<thead>
<tr>
<th><strong>命令</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>pytest（等价于：python -m pytest）</td>
<td>运行当前目录及其所有子目录下的所有测试用例</td>
</tr>
<tr>
<td>pytest .&#x2F;</td>
<td>运行当前目录及其所有子目录下的所有测试用例（和上一个命令效果相同）</td>
</tr>
<tr>
<td>pytest case\sub_case</td>
<td>运行指定目录 case\sub_case 及子目录下的所有测试用例</td>
</tr>
<tr>
<td>pytest case\test_demo. py</td>
<td>只运行指定的测试文件 case\test_demo.py 中的所有测试用例</td>
</tr>
<tr>
<td>pytest -k test_2</td>
<td>运行所有测试函数或方法名包含 test_2 的测试用例；这个命令会筛选出所有名字中带有 test_2 的测试用例来运行</td>
</tr>
<tr>
<td>pytest case\test_demo.py::test_a</td>
<td>只运行文件 case\test_demo.py 中的特定测试函数 test_a</td>
</tr>
<tr>
<td>pytest case\test_demo.py::TestDemo</td>
<td>只运行文件 case\test_demo.py 中的特定测试类 TestDemo 内的所有测试方法</td>
</tr>
<tr>
<td>pytest case\test_demo.py::TestDemo1:: test_c</td>
<td>只运行文件 case&#x2F;test_demo.py 中的特定测试类</td>
</tr>
</tbody></table>
<h2 id="pytest-ini-配置文件方式运行"><a href="#pytest-ini-配置文件方式运行" class="headerlink" title="pytest.ini 配置文件方式运行"></a>pytest.ini 配置文件方式运行</h2><p>pytest.ini 是 pytest 的主配置文件，可以添加配置改变 pytest 的默认行为，这样不用我们每次执行都在命令行中指定很多参数；此配置文件通常放到项目根目录下；配置文件样例：</p>
<figure class="highlight ini"><figcaption><span>file:pytest.ini</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="comment"># 命令行执行参数</span></span><br><span class="line"><span class="attr">addopts</span> = -vs --strict-markers</span><br><span class="line"><span class="comment"># 排除目录</span></span><br><span class="line"><span class="attr">norecursedirs</span> = xxx</span><br><span class="line"><span class="comment"># 默认执行目录</span></span><br><span class="line"><span class="attr">testpaths</span> = case</span><br><span class="line"><span class="comment"># 执行规则：class</span></span><br><span class="line"><span class="attr">python_classes</span> = Test*</span><br><span class="line"><span class="comment"># 执行规则：py文件</span></span><br><span class="line"><span class="attr">python_files</span> = test_* *_test</span><br><span class="line"><span class="comment"># 执行规则：function</span></span><br><span class="line"><span class="attr">python_functions</span> = test_*</span><br><span class="line"><span class="comment"># 自定义注册标记</span></span><br><span class="line"><span class="attr">markers</span> =</span><br><span class="line">    user: 用户模块</span><br><span class="line">    order: 订单模块</span><br></pre></td></tr></table></figure>

<p>以下是一些常用的配置选项以及解释：</p>
<p>1、<strong>addopts</strong>：用于设置命令行选项，这些选项将在每次运行 pytest 时自动添加</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">addopts</span> = -v -s --maxfail=<span class="number">3</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>-v</code>：详细模式</li>
<li><code>-s</code>：显示打印输出</li>
<li><code>--maxfail=3</code>：当有 3 个测试失败时停止运行</li>
</ul>
<p>2、<strong>testpaths</strong>：用于指定测试文件或者目录的路径，pytest 会在这些路径下查找测试</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">testpaths</span> = tests integration_tests</span><br></pre></td></tr></table></figure>

<p>在这个示例中，<code>pytest</code> 会在 <code>tests</code> 和 <code>integration_tests</code> 目录下查找测试文件</p>
<p>3、<strong>norecursedirs</strong>：用于指定 pytest 排除查找的目录</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">norecursedirs</span> = .git venv</span><br></pre></td></tr></table></figure>

<p>在这个示例中，<code>pytest</code> 会忽略 <code>.git</code> 和 <code>venv</code> 目录</p>
<p>4、<strong>filterwarnings</strong>：用于配置警告过滤器</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">filterwarnings</span> =</span><br><span class="line">    ignore::DeprecationWarning</span><br><span class="line">    ignore::UserWarning</span><br></pre></td></tr></table></figure>

<p>在这个示例中，<code>pytest</code> 会忽略 <code>DeprecationWarning</code> 和 <code>UserWarning</code> 类型的警告</p>
<p>5、<strong>markers</strong>：用于定义自定义标记，对于分区不同类型的测试非常有用</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">markers</span> =</span><br><span class="line">    slow: marks tests as slow (deselect with &#x27;-m &quot;not slow&quot;&#x27;)</span><br><span class="line">    integration: marks tests as integration tests</span><br></pre></td></tr></table></figure>

<p>在这个示例中，定义了两个标记：<code>slow</code> 和 <code>integration</code></p>
<p>6、<strong>timeout</strong>：用于设置测试的超过时间（需要 pytest-timeout 插件）</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">timeout</span>=<span class="number">300</span></span><br></pre></td></tr></table></figure>

<p>7、<strong>env</strong>：用于设置环境变量（需要 pytest-env 插件）</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">env</span> =</span><br><span class="line">    <span class="attr">ENV</span>=staging</span><br><span class="line">    <span class="attr">DEBUG</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>在这个示例中，配置了两个环境变量 <code>ENV</code> 和 <code>DEBUG</code></p>
<p>8、<strong>xfail_strict</strong>：用于设置 xfail 标记是否严格，默认为 false</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">xfail_strict</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>在这个示例中，<code>xfail</code> 标记会严格对待，如果标记的测试意外通过，测试将失败。</p>
<p>9、<strong>junit_family</strong>：用于设置生成的 JUnit XML 报告的格式。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span> </span><br><span class="line"><span class="attr">junit_family</span> = xunit2</span><br></pre></td></tr></table></figure>

<p>在这个示例中，生成的 JUnit XML 报告将使用 <code>xunit2</code> 格式</p>
<h1 id="pytest-conftest-py-文件"><a href="#pytest-conftest-py-文件" class="headerlink" title="pytest conftest.py 文件"></a>pytest conftest.py 文件</h1><p>conftest.py 特点：</p>
<ul>
<li>pytest 会默认读取 conftest.py 里面的所有 fixture</li>
<li>conftest.py 文件名称是固定的，不能改动</li>
<li>conftest.py 只对同一个 package 下的所有测试用例生效</li>
<li>不同目录可以有自己的 conftest.py，一个项目中可以有多个 conftest.py</li>
<li>测试用例文件中不需要手动 import conftest.py，pytest 会自动查找</li>
</ul>
<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240812173753.png" alt="image.png"></p>
<h1 id="pytest-fixture-装饰器"><a href="#pytest-fixture-装饰器" class="headerlink" title="pytest fixture 装饰器"></a>pytest fixture 装饰器</h1><h2 id="fixture-介绍"><a href="#fixture-介绍" class="headerlink" title="fixture 介绍"></a>fixture 介绍</h2><p>虽然 setup 和 teardown 可以执行一些前置和后置操作，但是这种是针对整个脚本全局生效的，如果有以下场景：</p>
<ol>
<li>用例一需要执行登录操作；</li>
<li>用例二不需要执行登录操作；</li>
<li>用例三需要执行登录操作，则 setup 和 teardown 则不满足要求</li>
</ol>
<p>fixture 的优势主要有如下四点：</p>
<ol>
<li>与 setup、teardown 类似，fixture 提供了测试执行前和测试执行后的处理，但是又比 setup、teardown 更灵活好用，比如：fixture 命名更加灵活，不局限于 setup 和 teardown</li>
<li>conftest.py 配置里可以实现数据共享，可以方便管理、修改和查看 fixture 函数，并且不需要 import 就能自动找到 fixture</li>
<li>fixture 可用于封装数据，也可用于封逻辑动作，使用范围非常广</li>
</ol>
<p>fixture 的调用方式：<code>@pytest.fixture(scope = &quot;function&quot;, params=None, autouse=False, ids=None, name=None)</code></p>
<h2 id="fixture-参数-scope"><a href="#fixture-参数-scope" class="headerlink" title="fixture 参数 scope"></a>fixture 参数 scope</h2><p>作用：</p>
<ul>
<li>用于控制 fixture 的作用范围</li>
<li>作用类似于 pytest 的 setup&#x2F;teardown</li>
<li>默认取值为 fuction，控制范围为 session &gt; module &gt; class &gt; function</li>
</ul>
<p>fixture 作用范围有四个：function、class、module 和 session</p>
<table>
<thead>
<tr>
<th>取值</th>
<th>范围说明</th>
</tr>
</thead>
<tbody><tr>
<td>function</td>
<td>函数级：每一个函数或方法都会调用</td>
</tr>
<tr>
<td>class</td>
<td>函数级：模块级每一个.py 文件调用一次</td>
</tr>
<tr>
<td>module</td>
<td>模块级：每一个.py 文件调用一次</td>
</tr>
<tr>
<td>session</td>
<td>会话级：每次会话只需要运行一次，会话内所有方法及类，模块都共享这个方法</td>
</tr>
</tbody></table>
<blockquote>
<p>[!note] function</p>
</blockquote>
<p>1、作为参数传递</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="comment"># fixture函数(类中) 作为多个参数传入</span></span><br><span class="line"><span class="meta">@pytest.fixture()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;打开浏览器&quot;</span>)</span><br><span class="line">    a = <span class="string">&quot;account&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">    </span><br><span class="line"><span class="meta">@pytest.fixture()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;关闭浏览器&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestLogin</span>:</span><br><span class="line">    <span class="comment">#传入lonin fixture</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_001</span>(<span class="params">self, login</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;001传入了loging fixture&quot;</span>)</span><br><span class="line">        <span class="keyword">assert</span> login == <span class="string">&quot;account&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">#传入logout fixture</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_002</span>(<span class="params">self, logout</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;002传入了logout fixture&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_003</span>(<span class="params">self, login, logout</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;003传入了两个fixture&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_004</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;004未传入仍何fixture哦&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main()</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240812185401.png" alt="image.png"></p>
<p>从运行结果可以看出，fixture 作为参数传入时，会在执行函数之前执行该 fixture 函数；再将值传入测试函数作为参数使用，这个场景多用于登录</p>
<p>2、fixture 的相互调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="comment"># fixtrue作为参数，互相调用传入</span></span><br><span class="line"><span class="meta">@pytest.fixture()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">account</span>():</span><br><span class="line">    a = <span class="string">&quot;account&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;第一层fixture&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">    </span><br><span class="line"><span class="comment">#Fixture的相互调用一定是要在测试类里调用这层fixture才会生次，普通函数单独调用是不生效的</span></span><br><span class="line"><span class="meta">@pytest.fixture()   </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">account</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;第二层fixture&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestLogin</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_1</span>(<span class="params">self, login</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;直接使用第二层fixture,返回值为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(login))</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_2</span>(<span class="params">self, account</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;只调用account fixture,返回值为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(account))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main()</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240812185622.png" alt="image.png"></p>
<p>得出结论：</p>
<ol>
<li>即使 fixture 之间支持相互调用，但普通函数直接调用 fixture 是不支持的，一定是在测试函数内调用才会逐级调用生效</li>
<li>有多层 fixture 调用时，最先执行的是最后一层 fixture，而不是先执行传入测试函数的fixture</li>
<li>上层 fixture 的值不会自动 return，这里就类似函数相互调用一样的逻辑</li>
</ol>
<blockquote>
<p>[!note] class</p>
</blockquote>
<p>1、当测试类内的每一个测试方法都调用了 fixture，fixture 只在该 class 下所有测试用例执行前执行一次</p>
<p>2、测试类下面只有一些测试方法使用了 fixture 函数名，这样的话，fixture 只在该 class 下<strong>第一个使用 fixture 函数的测试用例位置开始算</strong>，后面所有的测试用例执行前只执行一次。而该位置之前的测试用例就不管</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&#x27;class&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    a = <span class="string">&#x27;123&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;输入账号密码登陆&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestLogin</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用例1&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_2</span>(<span class="params">self, login</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用例2&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_3</span>(<span class="params">self, login</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用例3&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_4</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用例4&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main()</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240812190236.png" alt="image.png"></p>
<blockquote>
<p>[!note] moudule</p>
</blockquote>
<p>与 class 相同，只从 .py 文件开始引用 fixture 的位置生效</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&#x27;module&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;fixture范围为module&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_01</span>():  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;用例01&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_02</span>(<span class="params">login</span>):  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;用例02&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestLogin</span>():  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_1</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用例1&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_2</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用例2&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_3</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用例3&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    pytest.main()</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240812190557.png" alt="image.png"></p>
<blockquote>
<p>[!note] session</p>
</blockquote>
<p>session 的作用范围是针对 .py 级别的，module 是对当前 .py 生效，session 是对多个 .py 生效；session只作用于一个 .py 文件时，作用相当于module，所以session多数与contest.py文件一起使用，做为全局 Fixture</p>
<h2 id="fixture-参数-autouse"><a href="#fixture-参数-autouse" class="headerlink" title="fixture 参数 autouse"></a>fixture 参数 autouse</h2><p>autocase 默认为  False；若为 True，则每个测试函数都会自动调用该 fixture，无需传入 fixture 函数名；由此我们可以总结出调用 fixture 的三种方式：</p>
<ol>
<li>函数或类里面方法直接传fixture的函数参数名称</li>
<li>使用装饰器 @pytest.mark.usefixtures() 修饰</li>
<li>autouse&#x3D;True 自动调用，无需传仍何参数，作用范围跟着 scope 走</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">autouse=<span class="string">&quot;true&quot;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;当 autocase 为 true&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestLogin</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_1</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用例1&quot;</span>)  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_2</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用例2&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    pytest.main()</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240813000341.png" alt="image.png"></p>
<h2 id="fixture-参数-params"><a href="#fixture-参数-params" class="headerlink" title="fixture 参数 params"></a>fixture 参数 params</h2><ul>
<li>fixture 的可选形参列表，支持列表传入</li>
<li>默认 None，每个 param 的值 fixture 都会去调用执行一次，类似 for 循环  </li>
<li>可与参数 ids 一起使用，作为每个参数的标识</li>
<li>被 fixture 装饰的函数要调用是采用：Request.param</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">params=[<span class="number">1</span>,<span class="number">2</span>,&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>:<span class="number">2</span>&#125;,&#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>&#125;]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo</span>(<span class="params">request</span>):  </span><br><span class="line">    <span class="keyword">return</span> request.param  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_demo</span>(<span class="params">demo</span>):  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;value&#123;&#125;&quot;</span>.<span class="built_in">format</span>(demo))  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    pytest.main()</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240813001246.png" alt="image.png"></p>
<p>固定写法：在 pytest 中有一个内建的 fixture 叫做 request，代表 fixture 的调用状态。request 有一个字段 param，可以使用类似 <code>@pytest.fixture(param=tasks_list)</code> 的方式，在 fixture 中使用 <code>request.param</code> 的方式作为返回值供测试函数调用。其中 tasks_list 包含多少元素，该 fixture 就会被调用几次，分别作用在每个用到的测试函数上</p>
<h2 id="fixture-参数-ids"><a href="#fixture-参数-ids" class="headerlink" title="fixture 参数 ids"></a>fixture 参数 ids</h2><p>用例标识 id，每个 ids 和 params 一一对应，如果没有 id，将从 params 自动产生</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">params=[<span class="number">1</span>,<span class="number">2</span>,&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>:<span class="number">2</span>&#125;,&#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>&#125;], ids=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo</span>(<span class="params">request</span>):  </span><br><span class="line">    <span class="keyword">return</span> request.param  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_demo</span>(<span class="params">demo</span>):  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;value&#123;&#125;&quot;</span>.<span class="built_in">format</span>(demo))  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    pytest.main()</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240813001553.png" alt="image.png"></p>
<h2 id="fixture-参数-name"><a href="#fixture-参数-name" class="headerlink" title="fixture 参数 name"></a>fixture 参数 name</h2><p>fixture 的重命名：通常来说使用 fixture 的测试函数会将 fixture 的函数名作为参数传递，但是 pytest 也允许将fixture重命名；如果使用了name,那只能将name传如，函数名不再生效</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">name=<span class="string">&quot;new_fixture&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_name</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#使用name参数后，传入重命名函数，执行成功</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_1</span>(<span class="params">new_fixture</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;使用name参数后，传入重命名函数，执行成功&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#使用name参数后，仍传入函数名称，会失败</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_2</span>(<span class="params">test_name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;使用name参数后，仍传入函数名称，会失败&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240813002846.png" alt="image.png"></p>
<h1 id="pytest-跳过测试用例"><a href="#pytest-跳过测试用例" class="headerlink" title="pytest 跳过测试用例"></a>pytest 跳过测试用例</h1><h2 id="pytest-mark-skip"><a href="#pytest-mark-skip" class="headerlink" title="@pytest.mark.skip"></a>@pytest.mark.skip</h2><p>跳过执行测试用例，有可选择参数 reason：跳过的原因，会在执行结果中打印</p>
<ul>
<li>@pytest.mark.skip 可以加在函数上、类上、类方法上</li>
<li>如果加在类上面，类里面所有的测试用例多不会执行</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">autouse=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;====登录====&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_case01</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;我是测试用例11111&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@pytest.mark.skip(<span class="params">reason=<span class="string">&quot;不执行该用例！！因为没写好！！&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_case02</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;我是测试用例22222&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test1</span>:</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%% 我是类测试用例1111 %%&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @pytest.mark.skip(<span class="params">reason=<span class="string">&quot;不想执行&quot;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%% 我是类测试用例2222 %%&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@pytest.mark.skip(<span class="params">reason=<span class="string">&quot;类也可以跳过不执行&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestSkip</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%% 不会执行 %%&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="pytest-skip"><a href="#pytest-skip" class="headerlink" title="pytest.skip()"></a>pytest.skip()</h2><p>作用：在测试用例执行期间强制跳过不再执行<strong>剩余内容</strong>，类似于在 python 的循环中，满足某些条件则 break</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_function</span>():</span><br><span class="line">n = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;这是我第<span class="subst">&#123;n&#125;</span>条用例&quot;</span>)</span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">5</span>:</span><br><span class="line">        pytest.skip(<span class="string">&quot;我跑五次了不跑了&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="pytest-parametrize-参数化"><a href="#pytest-parametrize-参数化" class="headerlink" title="pytest parametrize 参数化"></a>pytest parametrize 参数化</h1><p>pytest 允许在多个级别启用测试参数化</p>
<ol>
<li>pytest.fixture() 允许 fixture 有参数化功能</li>
<li>pytest.mark.parametrize 允许在测试函数和类中定义多组参数和 fixtures</li>
<li>pytest_generate_tests 允许定义自定义参数化方案或扩展</li>
</ol>
<h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p>方法：<code>parametrize(argnames, argvalues, indirect=False, ids=None, scope=None)</code></p>
<p>常用参数：</p>
<p>1、<strong>argnames</strong>：参数名，格式为：”arg1,arg2,arg3,…”，通过逗号分隔多个参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多参数写法汇总：参数名可以是字符串、元组、列表、字符串放元组中</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;input,expected&quot;</span>, [(<span class="params"><span class="string">&quot;1+1&quot;</span>, <span class="number">2</span></span>), (<span class="params"><span class="string">&quot;2-4&quot;</span>, -<span class="number">2</span></span>), (<span class="params"><span class="string">&quot;2*3&quot;</span>, <span class="number">6</span></span>)]</span>)</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params">(<span class="params"><span class="string">&quot;input&quot;</span>,<span class="string">&quot;expected&quot;</span></span>), [(<span class="params"><span class="string">&quot;1+1&quot;</span>, <span class="number">2</span></span>), (<span class="params"><span class="string">&quot;2-4&quot;</span>, -<span class="number">2</span></span>), (<span class="params"><span class="string">&quot;2*3&quot;</span>, <span class="number">6</span></span>)]</span>)</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params">[<span class="string">&quot;input&quot;</span>,<span class="string">&quot;expected&quot;</span>], [(<span class="params"><span class="string">&quot;1+1&quot;</span>, <span class="number">2</span></span>), (<span class="params"><span class="string">&quot;2-4&quot;</span>, -<span class="number">2</span></span>), (<span class="params"><span class="string">&quot;2*3&quot;</span>, <span class="number">6</span></span>)]</span>)</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params">(<span class="params"><span class="string">&quot;input,expected&quot;</span></span>), [(<span class="params"><span class="string">&quot;1+1&quot;</span>, <span class="number">2</span></span>), (<span class="params"><span class="string">&quot;2-4&quot;</span>, -<span class="number">2</span></span>), (<span class="params"><span class="string">&quot;2*3&quot;</span>, <span class="number">6</span></span>)]</span>)</span></span><br></pre></td></tr></table></figure>

<p>2、<strong>argvalues</strong>：参数对应值，类型必须为 list；</p>
<ul>
<li>当参数为一个时格式：[v1]</li>
<li>当参数个数大于一个时，格式为：[(v1_1, v2_1, …), (v1_2, v2_2, …)]，一组参数值放元组或者列表中，也就是说，最外层列表可以嵌套元组或者列表</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;name,technology&quot;</span>,[[<span class="string">&#x27;韧&#x27;</span>,<span class="string">&#x27;测试开发&#x27;</span>],[<span class="string">&#x27;全栈测试笔记&#x27;</span>,<span class="string">&#x27;性能测试&#x27;</span>]]</span>)  </span><span class="comment"># 列表嵌列表</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;name,technology&quot;</span>,[(<span class="params"><span class="string">&#x27;韧&#x27;</span>,<span class="string">&#x27;测试开发&#x27;</span></span>),(<span class="params"><span class="string">&#x27;全栈测试笔记&#x27;</span>,<span class="string">&#x27;性能测试&#x27;</span></span>)]</span>)  </span><span class="comment"># 列表嵌套元组</span></span><br></pre></td></tr></table></figure>

<p>3、<strong>indirect</strong>：默认是 False，如果设置成 True，表示把被  parametrize 修饰器修饰的方法形参当函数执行（parametrize 中参数名和这个形参同名）；同时，必须有这个函数，且被 @pytest.fixture() 修饰，否则报错：fixture ‘xxx’ not found，xxx 表示形参名</p>
<p>4、<strong>ids</strong>：用例 id，用于标识用例，增加可读性（测试结果中会展示 id），是字符串列表，ids 的长度要与测试数据列表长度一致</p>
<h2 id="具体使用"><a href="#具体使用" class="headerlink" title="具体使用"></a>具体使用</h2><h3 id="单个参数的参数化"><a href="#单个参数的参数化" class="headerlink" title="单个参数的参数化"></a>单个参数的参数化</h3><p>参数方法形参名要和 parametrize 里面的参数一样</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;data&quot;</span>, [<span class="string">&#x27;韧&#x27;</span>, <span class="string">&#x27;全栈测试笔记&#x27;</span>, <span class="string">&#x27;性能测试&#x27;</span>, <span class="string">&#x27;自动化测试&#x27;</span>, <span class="string">&#x27;测试开发&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestQzcsbj</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_case</span>(<span class="params">self, data</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;data=<span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240808093302.png" alt="image.png"></p>
<h3 id="多个参数的参数化"><a href="#多个参数的参数化" class="headerlink" title="多个参数的参数化"></a>多个参数的参数化</h3><p>参数放列表中，且列表嵌套元组或者列表</p>
<p>示例一：修饰器放函数上，参数值是基本类型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;input,expected&quot;</span>, [(<span class="params"><span class="string">&quot;1+1&quot;</span>, <span class="number">2</span></span>), (<span class="params"><span class="string">&quot;2-4&quot;</span>, -<span class="number">2</span></span>), (<span class="params"><span class="string">&quot;2*3&quot;</span>, <span class="number">6</span></span>)]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_eval</span>(<span class="params"><span class="built_in">input</span>, expected</span>):  </span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">eval</span>(<span class="built_in">input</span>) == expected</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240808093444.png" alt="image.png"></p>
<p>示例二：修饰器放函数上，参数值是字典</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line">  </span><br><span class="line">data = [  </span><br><span class="line">    &#123;        </span><br><span class="line">    	<span class="string">&quot;input&quot;</span>: <span class="string">&quot;1+1&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;expected&quot;</span>: <span class="number">2</span>  </span><br><span class="line">    &#125;,  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="string">&quot;input&quot;</span>: <span class="string">&quot;2-4&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;expected&quot;</span>: -<span class="number">2</span>  </span><br><span class="line">    &#125;,  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="string">&quot;input&quot;</span>: <span class="string">&quot;2*3&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;expected&quot;</span>: <span class="number">6</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;par&quot;</span>, data</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_eval</span>(<span class="params">par</span>):  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;本次入参是：input=<span class="subst">&#123;par[<span class="string">&#x27;input&#x27;</span>]&#125;</span>, expected=<span class="subst">&#123;par[<span class="string">&#x27;expected&#x27;</span>]&#125;</span>&quot;</span>)  </span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">eval</span>(par[<span class="string">&#x27;input&#x27;</span>]) == par[<span class="string">&#x27;expected&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240808093607.png" alt="image.png"></p>
<p>示例三：修饰器放测试类上</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;name,technology&quot;</span>,[[<span class="string">&#x27;韧&#x27;</span>,<span class="string">&#x27;测试开发&#x27;</span>],[<span class="string">&#x27;全栈测试笔记&#x27;</span>,<span class="string">&#x27;性能测试&#x27;</span>]]</span>)  </span><span class="comment"># 列表嵌列表  </span></span><br><span class="line"><span class="comment"># @pytest.mark.parametrize(&quot;name,technology&quot;, [(&#x27;韧&#x27;, &#x27;测试开发&#x27;), (&#x27;全栈测试笔记&#x27;, &#x27;性能测试&#x27;)])  # 列表嵌套元组  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestQzcsbj</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_case</span>(<span class="params">self, name, technology</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;name=<span class="subst">&#123;name&#125;</span>, technology=<span class="subst">&#123;technology&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240808093822.png" alt="image.png"></p>
<p>示例四：测试类下多个方法，会将测试数据传给此类下所有测试方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @pytest.mark.parametrize(&quot;name,technology&quot;,[[&#x27;韧&#x27;,&#x27;测试开发&#x27;],[&#x27;全栈测试笔记&#x27;,&#x27;性能测试&#x27;]])  # 列表嵌列表  </span></span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;name,technology&quot;</span>, [(<span class="params"><span class="string">&#x27;韧&#x27;</span>, <span class="string">&#x27;测试开发&#x27;</span></span>), (<span class="params"><span class="string">&#x27;全栈测试笔记&#x27;</span>, <span class="string">&#x27;性能测试&#x27;</span></span>)]</span>)  </span><span class="comment"># 列表嵌套元组  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestQzcsbj</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_case1</span>(<span class="params">self, name, technology</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;test_case1: name=<span class="subst">&#123;name&#125;</span>, technology=<span class="subst">&#123;technology&#125;</span>&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_case2</span>(<span class="params">self, name, technology</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;test_case2: name=<span class="subst">&#123;name&#125;</span>, technology=<span class="subst">&#123;technology&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240808093904.png" alt="image.png"></p>
<h3 id="参数放变量中"><a href="#参数放变量中" class="headerlink" title="参数放变量中"></a>参数放变量中</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line">  </span><br><span class="line">data = [(<span class="string">&#x27;韧&#x27;</span>, <span class="string">&#x27;测试开发&#x27;</span>), (<span class="string">&#x27;全栈测试笔记&#x27;</span>, <span class="string">&#x27;性能测试&#x27;</span>)]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;name,technology&quot;</span>, data</span>)  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestQzcsbj</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_case</span>(<span class="params">self, name, technology</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;name=<span class="subst">&#123;name&#125;</span>, technology=<span class="subst">&#123;technology&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240808094848.png" alt="image.png"></p>
<h3 id="调用函数获取参数数据"><a href="#调用函数获取参数数据" class="headerlink" title="调用函数获取参数数据"></a>调用函数获取参数数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():  </span><br><span class="line">    <span class="keyword">return</span> [(<span class="string">&#x27;韧&#x27;</span>, <span class="string">&#x27;测试开发&#x27;</span>), (<span class="string">&#x27;全栈测试笔记&#x27;</span>, <span class="string">&#x27;性能测试&#x27;</span>)]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;name,technology&quot;</span>, get_data(<span class="params"></span>)</span>)  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestQzcsbj</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_case</span>(<span class="params">self, name, technology</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;name=<span class="subst">&#123;name&#125;</span>, technology=<span class="subst">&#123;technology&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240808094934.png" alt="image.png"></p>
<h3 id="mark-标记参数"><a href="#mark-标记参数" class="headerlink" title="mark 标记参数"></a>mark 标记参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params">  </span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;input,expected&quot;</span>,  </span></span></span><br><span class="line"><span class="params"><span class="meta">    [  </span></span></span><br><span class="line"><span class="params"><span class="meta">        (<span class="params"><span class="string">&quot;1+1&quot;</span>, <span class="number">2</span></span>),  </span></span></span><br><span class="line"><span class="params"><span class="meta">        pytest.param(<span class="params"><span class="string">&quot;2-4&quot;</span>, -<span class="number">2</span>, marks=[pytest.mark.minus, pytest.mark.xfail], <span class="built_in">id</span>=<span class="string">&quot;input:2-4&quot;</span></span>),  </span></span></span><br><span class="line"><span class="params"><span class="meta">        pytest.param(<span class="params"><span class="string">&quot;2*3&quot;</span>, <span class="number">6</span>, marks=[pytest.mark.multiplication, pytest.mark.skip], <span class="built_in">id</span>=<span class="string">&quot;input:2*3&quot;</span></span>),  </span></span></span><br><span class="line"><span class="params"><span class="meta">        pytest.param(<span class="params"><span class="string">&quot;4/2&quot;</span>, <span class="number">2</span>, marks=pytest.mark.division, <span class="built_in">id</span>=<span class="string">&quot;input:4/2&quot;</span></span>)  </span></span></span><br><span class="line"><span class="params"><span class="meta">    ]  </span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_eval</span>(<span class="params"><span class="built_in">input</span>, expected</span>):  </span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">eval</span>(<span class="built_in">input</span>) == expected</span><br></pre></td></tr></table></figure>

<p>添加配置：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">addopts</span> = -s --strict-markers</span><br><span class="line"><span class="attr">markers</span> =</span><br><span class="line">    minus</span><br><span class="line">    multiplication</span><br><span class="line">    division</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240808095046.png" alt="image.png"></p>
<h3 id="笛卡尔积：多个-parametrize-参数化修饰器"><a href="#笛卡尔积：多个-parametrize-参数化修饰器" class="headerlink" title="笛卡尔积：多个 parametrize 参数化修饰器"></a>笛卡尔积：多个 parametrize 参数化修饰器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;username&quot;</span>,[<span class="string">&quot;qzcsbj&quot;</span>,<span class="string">&quot;ren&quot;</span>,<span class="string">&quot;jack&quot;</span>]</span>)</span></span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;password&quot;</span>,[<span class="string">&quot;a123&quot;</span>,<span class="string">&quot;abc123&quot;</span>,<span class="string">&quot;ABC123&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestQzcsbj</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_case</span>(<span class="params">self, username, password</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;name=<span class="subst">&#123;username&#125;</span>, technology=<span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240808095144.png" alt="image.png"></p>
<h3 id="笛卡尔积：parametrize-与-fixture-混合"><a href="#笛卡尔积：parametrize-与-fixture-混合" class="headerlink" title="笛卡尔积：parametrize 与 fixture 混合"></a>笛卡尔积：parametrize 与 fixture 混合</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">params=[<span class="string">&quot;qzcsbj&quot;</span>, <span class="string">&quot;ren&quot;</span>, <span class="string">&quot;jack&quot;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">request</span>):  </span><br><span class="line">    <span class="keyword">return</span> request.param  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;password&quot;</span>, [<span class="string">&quot;a123&quot;</span>, <span class="string">&quot;abc123&quot;</span>, <span class="string">&quot;ABC123&quot;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_case</span>(<span class="params">fun, password</span>):  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;name=<span class="subst">&#123;fun&#125;</span>, password=<span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240808095244.png" alt="image.png"></p>
<h2 id="parametrize-数据驱动"><a href="#parametrize-数据驱动" class="headerlink" title="parametrize 数据驱动"></a>parametrize 数据驱动</h2><p>数据驱动就是通过数据的改变从而驱动自动化测试的执行，最终引起测试结果的改变。简单来说，就是参数化的应用。</p>
<p>数据量小的测试用例可以使用代码的参数化来实现数据驱动，数据量大的情况下建议使用一一种结构化的文件(例如 yaml、json 等) 来对数据进行存储，然后在测试用例中读取这些数据。</p>
<p>但是，建议不管数据多少，都要数据和代码的分离，方便维护</p>
<h3 id="parametrize-参数化数据来自-yaml-文件"><a href="#parametrize-参数化数据来自-yaml-文件" class="headerlink" title="parametrize 参数化数据来自 yaml 文件"></a>parametrize 参数化数据来自 yaml 文件</h3><figure class="highlight yaml"><figcaption><span>file:case.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">uname:</span> <span class="string">ren</span></span><br><span class="line">  <span class="attr">pwd:</span> <span class="number">123</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">uname:</span> <span class="string">qzcsbj</span></span><br><span class="line">  <span class="attr">pwd:</span> <span class="number">456</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 获取项目路径</span></span><br><span class="line">BASE_PATH = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_data_from_yaml</span>(<span class="params">file_path</span>):</span><br><span class="line">    f = <span class="built_in">open</span>(file_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    res = yaml.load(f, yaml.FullLoader)</span><br><span class="line">    f.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;返回的参数：<span class="subst">&#123;res&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"> </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;param&quot;</span>, read_data_from_yaml(<span class="params">BASE_PATH+<span class="string">&quot;/data/case.yaml&quot;</span></span>)</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_case</span>(<span class="params">param</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;uname=<span class="subst">&#123;param[<span class="string">&#x27;uname&#x27;</span>]&#125;</span>, pwd=<span class="subst">&#123;param[<span class="string">&#x27;pwd&#x27;</span>]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240812143112.png" alt="image.png"></p>
<h3 id="parametrize-参数化数据来自-json-文件"><a href="#parametrize-参数化数据来自-json-文件" class="headerlink" title="parametrize 参数化数据来自 json 文件"></a>parametrize 参数化数据来自 json 文件</h3><figure class="highlight json"><figcaption><span>file:case.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;uname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ren&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;uname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qzcsbj&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;456&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 获取项目路径</span></span><br><span class="line">BASE_PATH = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_data_from_json</span>(<span class="params">file_path</span>):</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        data = json.load(fp)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;返回的参数：<span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"> </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;param&quot;</span>, read_data_from_json(<span class="params">BASE_PATH+<span class="string">&quot;/data/case.json&quot;</span></span>)</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_case</span>(<span class="params">param</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;uname=<span class="subst">&#123;param[<span class="string">&#x27;uname&#x27;</span>]&#125;</span>, pwd=<span class="subst">&#123;param[<span class="string">&#x27;pwd&#x27;</span>]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="parametrize-参数化数据来自-excle-文件"><a href="#parametrize-参数化数据来自-excle-文件" class="headerlink" title="parametrize 参数化数据来自 excle 文件"></a>parametrize 参数化数据来自 excle 文件</h3><h3 id="parametrize-参数化数据来自-csv-文件"><a href="#parametrize-参数化数据来自-csv-文件" class="headerlink" title="parametrize 参数化数据来自 csv 文件"></a>parametrize 参数化数据来自 csv 文件</h3><p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240812143647.png" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 获取项目路径</span></span><br><span class="line">BASE_PATH = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_data_from_csv</span>(<span class="params">file_path</span>):</span><br><span class="line">    item = []</span><br><span class="line">    c = csv.reader(<span class="built_in">open</span>(file_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">        item.append(i)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;返回的参数：<span class="subst">&#123;item&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line"> </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;param&quot;</span>, read_data_from_csv(<span class="params">BASE_PATH+<span class="string">&quot;/data/case.csv&quot;</span></span>)</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_case</span>(<span class="params">param</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;uname=<span class="subst">&#123;param[<span class="number">0</span>]&#125;</span>, pwd=<span class="subst">&#123;param[<span class="number">1</span>]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="pytest-标记测试用例"><a href="#pytest-标记测试用例" class="headerlink" title="pytest 标记测试用例"></a>pytest 标记测试用例</h1><blockquote>
<p>[!note] 通常，我们通过分包或者分模块来对用例进行分类管理，如果只想执行符合某要求的部分用例，可以使用装饰器 @pytest.mark.xxx 给用例打标签（自定义标记）</p>
</blockquote>
<p>自定义标记使用流程：</p>
<ol>
<li>注册自定义标记（通过 pytest.ini 管理）</li>
<li>将模块、函数、类、方法进行业务标记</li>
<li>根据自定义标记运行用例</li>
</ol>
<h2 id="注册自定义标记"><a href="#注册自定义标记" class="headerlink" title="注册自定义标记"></a>注册自定义标记</h2><p>在 pytest.ini 文件中，新建标记：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">markers</span> =</span><br><span class="line">    user: user marker</span><br><span class="line">    product: product marker</span><br><span class="line">    findproduct</span><br><span class="line">    deleteproduct</span><br><span class="line">    modulex: modulex marker</span><br></pre></td></tr></table></figure>

<ol>
<li>标记名要是英文命名，建议参考模块命名，要有业务含义</li>
<li>所有自定义标记，建议在 pytest.ini 中进行统一管理，并通过命令参数 –strict-markers 进行授权（非必须）</li>
<li>pytest 中的 markers 配置相当于我们对用例的一种归类</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">addopts</span> = --strict-markers</span><br><span class="line"><span class="attr">markers</span> =</span><br><span class="line">    user: user marker</span><br><span class="line">    product: product marker</span><br><span class="line">    findproduct</span><br><span class="line">    deleteproduct</span><br><span class="line">    modulex: modulex marker</span><br></pre></td></tr></table></figure>

<ul>
<li>开启严格标记，如果标记不在配置文件中，会报错</li>
<li>不开启严格标记，如果标记不在配置文件中，会 warning</li>
</ul>
<p>获取现有标记：<code>pytest --markers</code>，包含自定义和内置</p>
<h2 id="自定义标记分类"><a href="#自定义标记分类" class="headerlink" title="自定义标记分类"></a>自定义标记分类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line">  </span><br><span class="line">pytestmark = pytest.mark.modulex  <span class="comment"># 模块类标记  </span></span><br><span class="line"><span class="comment"># pytestmark = [pytest.mark.modulex, pytest.mark.moduley]  # 可以注册多个  </span></span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">params=[<span class="string">&#x27;韧&#x27;</span>, <span class="string">&#x27;全栈测试笔记&#x27;</span>, <span class="string">&#x27;性能测试&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">request</span>):  <span class="comment"># 必须是request这个参数名  </span></span><br><span class="line">    <span class="keyword">return</span> request.param  <span class="comment"># 依次取列表中的每个值返回  </span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">params=[<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;car&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun2</span>(<span class="params">request</span>):  </span><br><span class="line">    <span class="keyword">return</span> request.param  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.mark.user  </span><span class="comment"># 函数标记  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_user_reg</span>(<span class="params">fun</span>):  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;---test_user_reg: <span class="subst">&#123;fun&#125;</span>&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.mark.user  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_user_login</span>():  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---test_user_login&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@pytest.mark.product  </span><span class="comment"># 类标记  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestProduct</span>:  </span><br><span class="line"><span class="meta">    @pytest.mark.findproduct  </span><span class="comment"># 方法标记  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_product_find</span>(<span class="params">self, fun2</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;---test_product_find: <span class="subst">&#123;fun2&#125;</span>&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="meta">    @pytest.mark.deleteproduct  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_product_delete</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;---test_product_delete&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>模块、函数、方法、类上都可以标记多个</li>
<li>模块比较的方式是：<code>pytestmark = [pytest.mark.modulex, pytest.mark.moduley]</code></li>
<li>函数、方法、类标记方式是：<code>@pytest.mark.module1</code></li>
</ul>
<h1 id="pytest-标记失败函数和失败重试"><a href="#pytest-标记失败函数和失败重试" class="headerlink" title="pytest 标记失败函数和失败重试"></a>pytest 标记失败函数和失败重试</h1><h2 id="标记为预期失败函数"><a href="#标记为预期失败函数" class="headerlink" title="标记为预期失败函数"></a>标记为预期失败函数</h2><p>方法：<code>xfail(condition=None, reason=None, raises=None, run=True, strict=False)</code></p>
<p>常用参数：</p>
<ul>
<li>condition：预期失败的条件，必传参数</li>
<li>reason：失败的原因，必传参数</li>
</ul>
<p>使用方式：<code>@pytest.mark.xfail(condition, reason=&quot;xx&quot;)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test_ABC</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup_class</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-------&gt;setup_class&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">teardown_class</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-------&gt;teardown_class&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_a</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-------&gt;test_a&quot;</span>)  </span><br><span class="line">        <span class="keyword">assert</span> <span class="number">1</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 标记为预期失败函数test_b  </span></span><br><span class="line"><span class="meta">    @pytest.mark.xfail(<span class="params"><span class="number">2</span> &gt; <span class="number">1</span>, reason=<span class="string">&quot;标注为预期失败&quot;</span></span>)  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_b</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-------&gt;test_b&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="失败后重试"><a href="#失败后重试" class="headerlink" title="失败后重试"></a>失败后重试</h2><p>需要安装第三方插件：pytest-return、pytest-returnfailures</p>
<h1 id="pytest-调整执行顺序"><a href="#pytest-调整执行顺序" class="headerlink" title="pytest 调整执行顺序"></a>pytest 调整执行顺序</h1><h1 id="pytest-设置断点"><a href="#pytest-设置断点" class="headerlink" title="pytest 设置断点"></a>pytest 设置断点</h1><p>在用例脚本中加入如下 python 代码，pytest会自动关闭执行输出的抓取，这里，其他test脚本不会受到影响，带断点的test上一个test正常输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pdb; pdb.set_trace()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_example</span>():</span><br><span class="line">	x = <span class="number">1</span></span><br><span class="line">	y = <span class="number">2</span></span><br><span class="line">	<span class="keyword">import</span> pdb; pdb.set_trace()  <span class="comment"># 这里设置断点</span></span><br><span class="line">	<span class="keyword">assert</span> x + y == <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>在运行上面的代码时，pytest 会在 pbd.set_trace() 处暂停，进入调试模式，可以在此处检查变量 x 和 y 的值</p>
<h1 id="pytest-获取用例执行性能"><a href="#pytest-获取用例执行性能" class="headerlink" title="pytest 获取用例执行性能"></a>pytest 获取用例执行性能</h1><p>获取最慢的 10 个用例的耗时：<code>pytest --durations=10</code></p>
<h1 id="pytest-断言"><a href="#pytest-断言" class="headerlink" title="pytest 断言"></a>pytest 断言</h1><p>在 pytest 中，断言（assertions）是用于验证测试结果是否符合预期的关键部分。断言允许你检查某个条件是否为真，如果条件为假，测试将失败并报告错误。</p>
<h2 id="基本断言"><a href="#基本断言" class="headerlink" title="基本断言"></a>基本断言</h2><p>pytest 最基本的断言形式是使用 Python 内置的 <strong>assert</strong> 语句，pytest 会捕获这些断言，并在断言失败时提供详细的错误信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_simple_assertion</span>():</span><br><span class="line">	result = <span class="number">1</span> + <span class="number">1</span></span><br><span class="line">	<span class="keyword">assert</span> result = <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240817003348.png" alt="image.png"></p>
<h2 id="复杂断言"><a href="#复杂断言" class="headerlink" title="复杂断言"></a>复杂断言</h2><p>pytest 支持复杂的断言，包括对集合、字典、对象等的检查</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_complex_assertion</span>():</span><br><span class="line">	data = &#123;<span class="string">&quot;key1&quot;</span>: <span class="string">&quot;value1&quot;</span>, <span class="string">&quot;key2&quot;</span>: <span class="string">&quot;value2&quot;</span>&#125;</span><br><span class="line">	<span class="keyword">assert</span> data[<span class="string">&quot;key1&quot;</span>] == <span class="string">&quot;value1&quot;</span></span><br><span class="line">	<span class="keyword">assert</span> <span class="string">&quot;key2&quot;</span> <span class="keyword">in</span> data</span><br><span class="line">	<span class="keyword">assert</span> data == &#123;<span class="string">&quot;key1&quot;</span>: <span class="string">&quot;value1&quot;</span>, <span class="string">&quot;key2&quot;</span>: <span class="string">&quot;value2&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240817003503.png" alt="image.png"></p>
<h2 id="自定义错误信息"><a href="#自定义错误信息" class="headerlink" title="自定义错误信息"></a>自定义错误信息</h2><p>可以在断言中添加自定义的错误信息以便在断言失败时提供更多的上下文信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_custom_error_message</span>():</span><br><span class="line">	result = <span class="number">1</span> + <span class="number">1</span></span><br><span class="line">	<span class="keyword">assert</span> result == <span class="number">3</span>, <span class="string">f&quot;Expected 3 but got <span class="subst">&#123;result&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240817004034.png" alt="image.png"></p>
<h2 id="断言异常"><a href="#断言异常" class="headerlink" title="断言异常"></a>断言异常</h2><p>pytest 提供了 <code>pytest.raises</code> 上下文管理器，用于断言某个代码块会抛出特定的异常</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_exception_assertion</span>():</span><br><span class="line">    <span class="keyword">with</span> pytest.raises(ZeroDivisionError):</span><br><span class="line">        result = <span class="number">1</span> / <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240817004218.png" alt="image.png"></p>
<p>在这个示例中，<code>pytest.raises(ZeroDivisionError)</code> 确保代码块 <code>result = 1 / 0</code> 会抛出 <code>ZeroDivisionError</code> 异常；如果异常没有抛出，测试将失败</p>
<h2 id="断言警告"><a href="#断言警告" class="headerlink" title="断言警告"></a>断言警告</h2><p>pytest 还提供了 <code>pytest.warns</code> 上下文管理器，用于断言某个代码块会抛出特定的警告</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_warning_assertion</span>():</span><br><span class="line">    <span class="keyword">with</span> pytest.warns(UserWarning):</span><br><span class="line">        warnings.warn(<span class="string">&quot;This is a warning&quot;</span>, UserWarning)</span><br></pre></td></tr></table></figure>

<p><img src="https://picture-picture.oss-cn-beijing.aliyuncs.com/img/20240817004531.png" alt="image.png"></p>
<p>在这个示例中，<code>pytest.warns(UserWarning)</code> 确保代码块 <code>warnings.warn(&quot;This is a warning&quot;, UserWarning)</code> 会抛出 <code>UserWarning</code> 警告；如果代码快没有警告，那么就会报错</p>
<h2 id="断言属性"><a href="#断言属性" class="headerlink" title="断言属性"></a>断言属性</h2><p>pytest 支持对对象属性的断言，可以使用 hasattr、getattr 等内置函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SampleClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.attribute = <span class="string">&quot;value&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_attribute_assertion</span>():</span><br><span class="line">    obj = SampleClass()</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">hasattr</span>(obj, <span class="string">&quot;attribute&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">getattr</span>(obj, <span class="string">&quot;attribute&quot;</span>) == <span class="string">&quot;value&quot;</span></span><br></pre></td></tr></table></figure>

<p>在这个示例中，断言检查了对象 obj 是否具有 attribute 属性，并且该属性的值是否为 “value”</p>
<h1 id="pytest-异常处理"><a href="#pytest-异常处理" class="headerlink" title="pytest 异常处理"></a>pytest 异常处理</h1><p>上文讲解断言时提到了断言异常，即为异常处理，在 pytest 中，异常处理允许编写测试来验证代码是否按照预期抛出异常；pytest 提供了 <strong>pytest.raises 上下文管理器</strong>用于捕获和校验异常</p>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><p><code>pytest.raises</code> 上下文管理器用于捕获特定的异常，并在异常未抛出时使测试失败</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_division</span>():  </span><br><span class="line">    <span class="keyword">with</span> pytest.raises(ZeroDivisionError):  </span><br><span class="line">        result = <span class="number">1</span> / <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>在这个示例中，<code>pytest.raises(ZeroDivisionError)</code> 确保代码块 <code>result = 1 / 0</code> 会抛出 <code>ZeroDivisionError</code> 异常；如果异常没有抛出，测试将失败</p>
<h2 id="获取异常信息"><a href="#获取异常信息" class="headerlink" title="获取异常信息"></a>获取异常信息</h2><p>可以通过 <code>pytest.raises</code> 的 <code>match</code> 参数来验证异常消息的内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_exception_message</span>():</span><br><span class="line">	<span class="keyword">with</span> pytest.raises(ValueError, <span class="keyword">match</span>=<span class="string">&quot;invalid literal for int()&quot;</span>):</span><br><span class="line">	    <span class="built_in">int</span>(<span class="string">&quot;not a number&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>在这个示例中，<code>pytest.raises(ValueError, match=&quot;invalid literal for int()&quot;)</code> 确保抛出的 <code>ValueError</code> 异常的消息包含 <code>&quot;invalid literal for int()&quot;</code></p>
<h2 id="访问异常对象"><a href="#访问异常对象" class="headerlink" title="访问异常对象"></a>访问异常对象</h2><p>可以通过 <code>pytest.raises</code> 的 <code>as</code> 语法来捕获异常对象，并对其进行进一步的检查</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_exception_object</span>():</span><br><span class="line">	<span class="keyword">with</span> pytest.raises(ValueError) <span class="keyword">as</span> exc_info:</span><br><span class="line">	    <span class="built_in">int</span>(<span class="string">&quot;not a number&quot;</span>)</span><br><span class="line">	<span class="keyword">assert</span> <span class="built_in">str</span>(exc_info.value) == <span class="string">&quot;invalid literal for int(): not a number&quot;</span></span><br></pre></td></tr></table></figure>

<p>在这个示例中，<code>exc_info</code> 是一个 <code>ExceptionInfo</code> 对象，包含了捕获的异常信息。你可以通过 <code>exc_info.value</code> 访问异常对象，并进行断言</p>
<h2 id="结合固件使用"><a href="#结合固件使用" class="headerlink" title="结合固件使用"></a>结合固件使用</h2><p><code>pytest.raises</code> 可以与固件（fixtures）结合使用，以确保在特定的测试上下文中抛出异常</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_data</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;not a number&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_exception_with_fixture</span>(<span class="params">setup_data</span>):</span><br><span class="line">    <span class="keyword">with</span> pytest.raises(ValueError):</span><br><span class="line">        <span class="built_in">int</span>(setup_data)</span><br></pre></td></tr></table></figure>

<p>在这个示例中，<code>setup_data</code> 固件提供了测试数据，<code>pytest.raises(ValueError)</code> 确保在将 <code>setup_data</code> 转换为整数时抛出 <code>ValueError</code> 异常</p>
<h2 id="嵌套异常处理"><a href="#嵌套异常处理" class="headerlink" title="嵌套异常处理"></a>嵌套异常处理</h2><p><code>pytest.raises</code> 可以嵌套在其他上下文管理器中，以处理更复杂的异常场景</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_nested_exception</span>():</span><br><span class="line">    <span class="keyword">with</span> pytest.raises(ZeroDivisionError):</span><br><span class="line">        <span class="keyword">with</span> pytest.warns(UserWarning):</span><br><span class="line">            result = <span class="number">1</span> / <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>在这个示例中，<code>pytest.raises(ZeroDivisionError)</code> 确保 <code>result = 1 / 0</code> 抛出 <code>ZeroDivisionError</code> 异常，而 <code>pytest.warns(UserWarning)</code> 确保在执行代码块时抛出 <code>UserWarning</code> 警告</p>
<h1 id="pytest-配置过滤警告"><a href="#pytest-配置过滤警告" class="headerlink" title="pytest 配置过滤警告"></a>pytest 配置过滤警告</h1><p>关于警告：如果警告不重要，可以忽略；如果警告很重要，可以升级为异常</p>
<h2 id="配置过滤警告"><a href="#配置过滤警告" class="headerlink" title="配置过滤警告"></a>配置过滤警告</h2><p>1、命令行参数，pytest case\test_qzcsbj.py -vs -W error::UserWarning，表示将 UserWarning 警告转换为错误</p>
<p>2、pytest.ini 配置文件：表示将 UserWarning 警告转换为错误，其它忽略</p>
<figure class="highlight ini"><figcaption><span>file:pytest.ini</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">filterwarnings</span> =</span><br><span class="line">    ignore</span><br><span class="line">    error::UserWarning</span><br></pre></td></tr></table></figure>

<h2 id="装饰器-filterwarnings-过滤"><a href="#装饰器-filterwarnings-过滤" class="headerlink" title="装饰器 filterwarnings 过滤"></a>装饰器 filterwarnings 过滤</h2><p>我们可以使用 @pytest.mark.filterwarnings 向特定测试项添加警告筛选器，这样可以做到更细节的控制警告</p>
<p>1、函数、方法级过滤</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># @pytest.mark.filterwarnings(&quot;ignore:.*自定义.*&quot;)</span></span><br><span class="line"><span class="meta">@pytest.mark.filterwarnings(<span class="params"><span class="string">&quot;ignore::UserWarning&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_a</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---test_a&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> fun()==<span class="number">1</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---fun&quot;</span>)</span><br><span class="line">    warnings.warn(UserWarning(<span class="string">&quot;自定义 warning&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>2、类级过滤</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="meta">@pytest.mark.filterwarnings(<span class="params"><span class="string">&quot;ignore:自定义&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test01</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_a</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;---test_a&quot;</span>)</span><br><span class="line">        <span class="keyword">assert</span> self.fun()==<span class="number">1</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;---fun&quot;</span>)</span><br><span class="line">        warnings.warn(UserWarning(<span class="string">&quot;自定义 warning&quot;</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>3、模块级过滤</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"> </span><br><span class="line"><span class="comment"># pytestmark = pytest.mark.filterwarnings(&quot;ignore:自定义&quot;)</span></span><br><span class="line">pytestmark = pytest.mark.filterwarnings(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test01</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_a</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;---test_a&quot;</span>)</span><br><span class="line">        <span class="keyword">assert</span> self.fun()==<span class="number">1</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;---fun&quot;</span>)</span><br><span class="line">        warnings.warn(UserWarning(<span class="string">&quot;自定义 warning&quot;</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
</article><div class="tag_share"><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/02/Charles%E5%AD%A6%E4%B9%A0/" title="Charles学习"><img class="cover" src="https://picture-picture.oss-cn-beijing.aliyuncs.com/wallhaven-exrqrr.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Charles学习</div></div></a></div><div class="next-post pull-right"><a href="/2024/06/30/TestNG%E5%AD%A6%E4%B9%A0/" title="TestNG学习"><img class="cover" src="https://picture-picture.oss-cn-beijing.aliyuncs.com/wallhaven-exrqrr.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">TestNG学习</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">pytest 基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pytest-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">pytest 介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pytest-%E7%BC%96%E5%86%99%E8%A7%84%E5%88%99"><span class="toc-number">1.2.</span> <span class="toc-text">pytest 编写规则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-%E8%BF%90%E8%A1%8C%E6%96%B9%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">pytest 运行方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C"><span class="toc-number">2.1.</span> <span class="toc-text">主函数运行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%BF%90%E8%A1%8C"><span class="toc-number">2.2.</span> <span class="toc-text">命令行运行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pytest-ini-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%96%B9%E5%BC%8F%E8%BF%90%E8%A1%8C"><span class="toc-number">2.3.</span> <span class="toc-text">pytest.ini 配置文件方式运行</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-conftest-py-%E6%96%87%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">pytest conftest.py 文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-fixture-%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">pytest fixture 装饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#fixture-%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">fixture 介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fixture-%E5%8F%82%E6%95%B0-scope"><span class="toc-number">4.2.</span> <span class="toc-text">fixture 参数 scope</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fixture-%E5%8F%82%E6%95%B0-autouse"><span class="toc-number">4.3.</span> <span class="toc-text">fixture 参数 autouse</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fixture-%E5%8F%82%E6%95%B0-params"><span class="toc-number">4.4.</span> <span class="toc-text">fixture 参数 params</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fixture-%E5%8F%82%E6%95%B0-ids"><span class="toc-number">4.5.</span> <span class="toc-text">fixture 参数 ids</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fixture-%E5%8F%82%E6%95%B0-name"><span class="toc-number">4.6.</span> <span class="toc-text">fixture 参数 name</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-%E8%B7%B3%E8%BF%87%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="toc-number">5.</span> <span class="toc-text">pytest 跳过测试用例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pytest-mark-skip"><span class="toc-number">5.1.</span> <span class="toc-text">@pytest.mark.skip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pytest-skip"><span class="toc-number">5.2.</span> <span class="toc-text">pytest.skip()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-parametrize-%E5%8F%82%E6%95%B0%E5%8C%96"><span class="toc-number">6.</span> <span class="toc-text">pytest parametrize 参数化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.1.</span> <span class="toc-text">基本介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E4%BD%BF%E7%94%A8"><span class="toc-number">6.2.</span> <span class="toc-text">具体使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0%E5%8C%96"><span class="toc-number">6.2.1.</span> <span class="toc-text">单个参数的参数化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0%E5%8C%96"><span class="toc-number">6.2.2.</span> <span class="toc-text">多个参数的参数化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%94%BE%E5%8F%98%E9%87%8F%E4%B8%AD"><span class="toc-number">6.2.3.</span> <span class="toc-text">参数放变量中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">6.2.4.</span> <span class="toc-text">调用函数获取参数数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mark-%E6%A0%87%E8%AE%B0%E5%8F%82%E6%95%B0"><span class="toc-number">6.2.5.</span> <span class="toc-text">mark 标记参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%EF%BC%9A%E5%A4%9A%E4%B8%AA-parametrize-%E5%8F%82%E6%95%B0%E5%8C%96%E4%BF%AE%E9%A5%B0%E5%99%A8"><span class="toc-number">6.2.6.</span> <span class="toc-text">笛卡尔积：多个 parametrize 参数化修饰器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%EF%BC%9Aparametrize-%E4%B8%8E-fixture-%E6%B7%B7%E5%90%88"><span class="toc-number">6.2.7.</span> <span class="toc-text">笛卡尔积：parametrize 与 fixture 混合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#parametrize-%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8"><span class="toc-number">6.3.</span> <span class="toc-text">parametrize 数据驱动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#parametrize-%E5%8F%82%E6%95%B0%E5%8C%96%E6%95%B0%E6%8D%AE%E6%9D%A5%E8%87%AA-yaml-%E6%96%87%E4%BB%B6"><span class="toc-number">6.3.1.</span> <span class="toc-text">parametrize 参数化数据来自 yaml 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parametrize-%E5%8F%82%E6%95%B0%E5%8C%96%E6%95%B0%E6%8D%AE%E6%9D%A5%E8%87%AA-json-%E6%96%87%E4%BB%B6"><span class="toc-number">6.3.2.</span> <span class="toc-text">parametrize 参数化数据来自 json 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parametrize-%E5%8F%82%E6%95%B0%E5%8C%96%E6%95%B0%E6%8D%AE%E6%9D%A5%E8%87%AA-excle-%E6%96%87%E4%BB%B6"><span class="toc-number">6.3.3.</span> <span class="toc-text">parametrize 参数化数据来自 excle 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parametrize-%E5%8F%82%E6%95%B0%E5%8C%96%E6%95%B0%E6%8D%AE%E6%9D%A5%E8%87%AA-csv-%E6%96%87%E4%BB%B6"><span class="toc-number">6.3.4.</span> <span class="toc-text">parametrize 参数化数据来自 csv 文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-%E6%A0%87%E8%AE%B0%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="toc-number">7.</span> <span class="toc-text">pytest 标记测试用例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E8%AE%B0"><span class="toc-number">7.1.</span> <span class="toc-text">注册自定义标记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E8%AE%B0%E5%88%86%E7%B1%BB"><span class="toc-number">7.2.</span> <span class="toc-text">自定义标记分类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-%E6%A0%87%E8%AE%B0%E5%A4%B1%E8%B4%A5%E5%87%BD%E6%95%B0%E5%92%8C%E5%A4%B1%E8%B4%A5%E9%87%8D%E8%AF%95"><span class="toc-number">8.</span> <span class="toc-text">pytest 标记失败函数和失败重试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E8%AE%B0%E4%B8%BA%E9%A2%84%E6%9C%9F%E5%A4%B1%E8%B4%A5%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.</span> <span class="toc-text">标记为预期失败函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%B1%E8%B4%A5%E5%90%8E%E9%87%8D%E8%AF%95"><span class="toc-number">8.2.</span> <span class="toc-text">失败后重试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-%E8%B0%83%E6%95%B4%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">9.</span> <span class="toc-text">pytest 调整执行顺序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-%E8%AE%BE%E7%BD%AE%E6%96%AD%E7%82%B9"><span class="toc-number">10.</span> <span class="toc-text">pytest 设置断点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-%E8%8E%B7%E5%8F%96%E7%94%A8%E4%BE%8B%E6%89%A7%E8%A1%8C%E6%80%A7%E8%83%BD"><span class="toc-number">11.</span> <span class="toc-text">pytest 获取用例执行性能</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-%E6%96%AD%E8%A8%80"><span class="toc-number">12.</span> <span class="toc-text">pytest 断言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%96%AD%E8%A8%80"><span class="toc-number">12.1.</span> <span class="toc-text">基本断言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E6%96%AD%E8%A8%80"><span class="toc-number">12.2.</span> <span class="toc-text">复杂断言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">12.3.</span> <span class="toc-text">自定义错误信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%AD%E8%A8%80%E5%BC%82%E5%B8%B8"><span class="toc-number">12.4.</span> <span class="toc-text">断言异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%AD%E8%A8%80%E8%AD%A6%E5%91%8A"><span class="toc-number">12.5.</span> <span class="toc-text">断言警告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%AD%E8%A8%80%E5%B1%9E%E6%80%A7"><span class="toc-number">12.6.</span> <span class="toc-text">断言属性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">13.</span> <span class="toc-text">pytest 异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">13.1.</span> <span class="toc-text">基本用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BC%82%E5%B8%B8%E4%BF%A1%E6%81%AF"><span class="toc-number">13.2.</span> <span class="toc-text">获取异常信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%BC%82%E5%B8%B8%E5%AF%B9%E8%B1%A1"><span class="toc-number">13.3.</span> <span class="toc-text">访问异常对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E5%90%88%E5%9B%BA%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">13.4.</span> <span class="toc-text">结合固件使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">13.5.</span> <span class="toc-text">嵌套异常处理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pytest-%E9%85%8D%E7%BD%AE%E8%BF%87%E6%BB%A4%E8%AD%A6%E5%91%8A"><span class="toc-number">14.</span> <span class="toc-text">pytest 配置过滤警告</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%BF%87%E6%BB%A4%E8%AD%A6%E5%91%8A"><span class="toc-number">14.1.</span> <span class="toc-text">配置过滤警告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8-filterwarnings-%E8%BF%87%E6%BB%A4"><span class="toc-number">14.2.</span> <span class="toc-text">装饰器 filterwarnings 过滤</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Ethan</div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://ethan-tsui.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="docsearch-wrap"><div id="docsearch" style="display:none"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3.5.2/dist/style.min.css"/><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3.5.2/dist/umd/index.min.js"></script><script>(() => {
  docsearch(Object.assign({
    appId: 'VZ4QTD5D9F',
    apiKey: '2f3da2750be0865bc553ee8c412e7831',
    indexName: 'ethan_tsui@foxmail.com',
    container: '#docsearch',
  }, null))

  const handleClick = () => {
    document.querySelector('.DocSearch-Button').click()
  }

  const searchClickFn = () => {
    btf.addEventListenerPjax(document.querySelector('#search-button > .search'), 'click', handleClick)
  }

  searchClickFn()
  window.addEventListener('pjax:complete', searchClickFn)
})()</script></div></div></body></html>